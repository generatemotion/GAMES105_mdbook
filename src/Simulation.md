# Lecture 08



P4   
## Physics-based Character Animation  

[ControlVAE â€“ Yao et al. 2022]  


> &#x2705; ç‰©ç†æ–¹æ³•çš„éš¾ç‚¹ï¼š  
> &#x2705; (1) ä»¿çœŸï¼šåœ¨è®¡ç®—æœºä¸­æ¨¡æ‹Ÿå‡ºçœŸå®ä¸–ç•Œçš„è¿è¡Œæ–¹å¼ã€‚   
> &#x2705; (2) æ§åˆ¶ï¼šç”Ÿæˆè§’è‰²çš„åŠ¨ä½œï¼Œæ¥åšå‡ºå“åº”ã€‚  



P5  
## Outline   

 - Simulation Basis   
    - Numerical Integration: Euler methods   
 - Equations of Rigid Bodies   
    - Rigid Body Kinematics   
    - Newton-Euler equations   
 - Articulated Rigid Bodies   
    - Joints and constraints   
 - Contact Models   
    - Penalty-based contact   
    - Constraint-based contact      

<https://www.cs.cmu.edu/~baraff/sigcourse/>

> &#x2705; è§’è‰²ç‰©ä½“åŠ¨ç”»é€šå¸¸ä¸å…³å¿ƒä»¿çœŸæ€ä¹ˆå®ç°ã€‚   
> &#x2705; ä½†ä¹Ÿå¯ä»¥æŠŠä»¿çœŸå½“æˆç™½ç›’ï¼Œç”¨æ¨¡å‹çš„æ–¹æ³•æ¥å®ç°ã€‚  
> &#x2705; ç²’å­è¿åŠ¨æ¨¡æ‹Ÿçš„éƒ¨åˆ†è·³è¿‡ã€‚P6-P22    
> &#x2705; å¼¹ç°§æ¨¡æ‹Ÿè·³è¿‡ã€‚P23-P27   
> &#x2705; åˆšä½“æ¨¡æ‹Ÿè·³è¿‡ã€‚P28-P56   


P57  
## Kinematics vs. Dynamics

![](./assets/08-01.png)

> &#x2705; è¿åŠ¨å­¦ä¸åŠ¨åŠ›å­¦ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæœ‰æ²¡æœ‰è€ƒè™‘è§’è‰²è´¨é‡ã€‚å› ä¸ºè´¨é‡ä»£è¡¨è´¯æ€§ï¼Œæœ‰è´¯æ€§å°±ä¸èƒ½ç¬ç§»ã€‚   
> &#x2705; åŠ¨åŠ›å­¦åŸºæœ¬æ¦‚å¿µè·³è¿‡ã€‚P58-P89   


P91   
## A System with Two Links

![](./assets/08-02.png)

> &#x2705; ä¸¤ä¸ªåˆšä½“çš„åœºæ™¯ï¼Œå¦‚æœä¸¤ä¸ªåˆšä½“ç‹¬ç«‹ï¼Œå¯ä»¥ä»¥çŸ©é˜µçš„æ–¹å¼æ‰©å±•ã€‚  

  

P92   
> &#x2705; ç‰©ä½“åœ¨åŠ›çš„ä½œç”¨ä¸‹çš„ç‰©ç†çŠ¶æ€çš„æ›´æ–°å…¬å¼ï¼è§ GAMES 103ï¼   
> &#x2705; æ¯ä¸€è¡Œæ˜¯ç‹¬ç«‹çš„ï¼Œè”ç«‹èµ·æ¥ä¸ºæ–¹ç¨‹ç»„ã€‚   




P93   

## A System with Two Links

![](./assets/08-03.png)


$$
M\dot{v} +C(x,v)=f
$$


> &#x2705; ç»“æœæ˜¯ä¸¤ä¸ªç‰©ä½“ä¼šåˆ†å¼€ã€‚  






P95  
## A System with Two Links and a Joint

![](./assets/08-04.png)

$$
M\dot{v} +C(x,v)=f+f_J
$$

> &#x2705; ä¸¤ä¸ªç‰©ä½“ä¸­é—´æœ‰ä¸€ä¸ªå…³èŠ‚ï¼Œçº¦æŸä¸¤ä¸ªç‰©ä½“ä¸èƒ½åˆ†å¼€ã€‚   
> &#x2705; ä½† \\(f_J\\) æ˜¯æœªçŸ¥çš„ã€‚  





P97  

## Constraints  

![](./assets/08-05-1.png)
![](./assets/08-05-2.png)

> &#x2705; å‡æ²¡æœ‰ä¸€çº¦æŸï¼šå°çƒå¿…é¡»æŒ‰è½¨é“è¡Œè¿›ã€‚   
> &#x2705; ç”±äºæ¯ä¸€æ—¶åˆ»éƒ½æ»¡è¶³ï¼Œå¯¹æ—¶é—´æ±‚å¯¼ï¼Œå¯¼æ•°ä¸ºé›¶ã€‚    
ï¼»ï¼ ï¼½åˆ†å­æˆªå›¾.     



P98 

![](./assets/08-5.png)






P99  
## Constraint Force

![](./assets/08-06.png)

\\(^\ast \\) Constraint is passive No energy gain or loss!!!   

$$
f_c\cdot v=0
$$



> &#x2705; ä¸ºäº†è®©å°çƒæ»¡è¶³çº¦æŸï¼Œéœ€ç»™å°çƒä¸€ä¸ªçº¦æŸåŠ›ã€‚   
> &#x2705; çº¦æŸåŠ›ä¸åº”äº§ç”Ÿèƒ½é‡ï¼Œå³åŠ›ä¸è¿åŠ¨æ–¹å‘å‚ç›´ã€‚   



P100   

![](./assets/08-07.png)


> &#x2705; \\(f_c\\) ä¸ \\(J\\) åŒæ–¹å‘ï¼Œä½†å¤§å°æœªçŸ¥ã€‚   
> &#x2705; \\(f_c\\) å¤§å°ä»¥å½“å‰çŠ¶æ€å’Œå¤–åŠ›æƒ…å†µè®¡ç®—è€Œå¾—ã€‚   

 


P101   
## Equation of Motion with Constraints

![](./assets/08-08.png)

$$
\begin{align*}
 M\dot{v} & =f+J^T\lambda  \\\\
  Jv&=0
\end{align*}
$$

$$
\begin{align*}
 M\frac{v_{n+1}-v_n}{h}  & =f+J^T\lambda  \\\\
  Jv_{n+1}&=0
\end{align*}
$$



> &#x2705; å‡è®¾\\(Mï¼Œxï¼Œvï¼f\\) å·²çŸ¥ï¼Œæ±‚ \\(f_c\\)    
> &#x2705; å…¬å¼1ï¼š\\(fï¼am\\)ï¼å…¬å¼2ï¼šå‰é¢æ¨å¯¼å¾—å‡ºã€‚   
> &#x2705; æŠŠä¸¤ä¸ªå…¬å¼ç¦»æ•£åŒ–ã€‚   
> &#x2705; æœªçŸ¥æ•°ï¼š\\(\lambda ï¼Œv_{n+1}\\) æ–¹ç¨‹ç»„è”ç«‹ï¼Œæ±‚è§£ã€‚     
> &#x2705; ç¦»æ•£åŒ–åå¯¹åŸå…¬å¼åªæ˜¯è¿‘ä¼¼ï¼Œä¼šæœ‰è¯¯å·®ï¼Œå¯¼åˆ°å°çƒè¿œç¦»æ›²çº¿ã€‚
> &#x2705; å¯¹å°çƒåšå—åŠ›åˆ†æï¼Œå—åˆ°å¤–åŠ›\\(f\\)å’Œçº¦æŸåŠ›\\(f_c\\)ï¼  
> &#x2705; \\(f\\)å·²çŸ¥ï¼Œæ±‚\\(f_c\\)ï¼Œä½¿å¾—å°çƒæ²¿è½¨è¿¹ç§»åŠ¨ã€‚   
> &#x2705; å› ä¸ºå…¬å¼2åªçº¦æŸäº†é€Ÿåº¦æ²¡æœ‰çº¦æŸä½ç½®ã€‚   

P103  

## Numerical Solution   

$$
Jv_{n+1}=\alpha \frac{C-g(x_n)}{h} 
$$

Correction of numerical errors   
ğ›¼: error reduction parameter (ERP)   


> &#x2705; è§£å†³æ–¹æ³•ï¼šå½“ç‰©ä½“åç¦»è½¨é“ï¼Œè¦æœ‰æ‹‰å›æ¥çš„é€Ÿåº¦ã€‚   



P104   

## Numerical Solution   


![](./assets/08-09.png)
 


> &#x2705; æŠŠERPç®€å†™ä¸º \\(b\\).  
> &#x2705; ä¸ºäº†é˜²æ­¢çŸ©é˜µä¸å¯é€†ï¼Œå¢åŠ  \\(\beta I\\).ï¼ˆå¸¸è§æŠ€å·§ï¼‰   
> &#x2705; è§£\\(\lambda\\)éœ€è¦å…ˆæ±‚é€†ã€‚   


P105   
## Joint Constraint

![](./assets/08-10.png)

$$
x_1+R_1r_1=x_J=x_2+R_2r_2
$$

å¯¹\\(dt\\)æ±‚å¯¼ï¼š

$$
v_1+\omega _1\times r_1=v_2+\omega _2\times r_2
$$

> &#x2705; å‰é¢æ˜¯çº¦æŸåº”ç”¨çš„ç®€å•ä¾‹å­ï¼Œå¦‚ä½•æŠŠçº¦æŸåº”ç”¨åˆ°ä¸¤ä¸ªç‰©ä½“çš„è¿æ¥çº¦æŸä¸Šã€‚   
> &#x2705; çº¦æŸï¼šä» \\(x_1\\) æ±‚ \\(x_J\\) å’Œä» \\(x_2\\) æ±‚ \\(x_J\\) æ‰€å¾—ç»“æœåº”è¯¥ç›¸åŒã€‚  



P106   
## Joint Constraint

$$
\begin{bmatrix}
 I_3 & -[r_1] _ \times  & -I_3 & [r_2] _ \times 
\end{bmatrix}\begin{bmatrix}
v_1 \\\\
w_1 \\\\
v_2 \\\\
w_2
\end{bmatrix}=0
$$

$$
Jv=0
$$


> &#x2705; æ•´ç†å¾—çŸ©é˜µå½¢å¼   
> &#x2705; çŸ©é˜µä¹˜æ³•ç¬¬ä¸€é¡¹ä¸º \\(J\\)ï¼Œç¬¬äºŒé¡¹ä¸º \\(v\\).   
> &#x2705; å…¬å¼1ï¼šè¿åŠ¨æ–¹ç¨‹ã€‚å…¬å¼2ï¼šçº¦æŸæ–¹ç¨‹ã€‚  



P107   
 
## Simulation of a Rigid Body System   

$$
\begin{align*}
 M\dot{v} +C(x,v)& =f+J^T\lambda  \\\\
  Jv&=0
\end{align*}
$$


> &#x2705; è¿åŠ¨æ–¹ç¨‹ä¸çº¦æŸæ–¹ç¨‹è”ç«‹ã€‚   


P109  
## Different Types of Joints

![](./assets/08-11.png)


> &#x2705; è¿™é‡Œæè¿°çš„æ˜¯Ballçº¦æŸã€‚   
> &#x2705; Hingeçº¦æŸï¼šé™¤äº†ä½ç½®è¿˜æœ‰è§’é€Ÿåº¦çº¦æŸï¼Œåœ¨æŸä¸ªè½´ä¸Šçš„è§’é€Ÿåº¦åº”å½“ä¸€è‡´ã€‚Universalç±»ä¼¼ã€‚    



P110   
## A System with Many Links Joints   


![](./assets/08-12.png)


> &#x2705; åˆ†æ®µå¤šåˆšä½“åœ¨å…¬å¼ä¸Šæ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œåªæ˜¯çŸ©é˜µæ›´å¤§ä¸€ç‚¹ã€‚   


P111   
## Contacts

![](./assets/08-13.png)


> &#x2705; å¦‚ä½•å¤„ç†ä¸åœ°é¢çš„æ¥è§¦ï¼Œè®©äººç«™åœ¨åœ°é¢ä¸Šã€‚  
> &#x2705; è¦è§£å†³çš„é—®é¢˜ï¼š(1) åœ°é¢æ¥è§¦æ£€æµ‹ (2) å¦‚ä½•å¯¹ç¢°æ’ç‚¹æ–½åŠ åŠ›ï¼Œä½¿ç‰©ä½“å‡ºæ¥ã€‚  




P114  
## Penalty-based Contact Model   


![](./assets/08-14.png)

$$
f_n=-k_pd-k_dv_{c,\perp }
$$


> &#x2705; ç±»ä¼¼å¼¹ç°§å½¢å¼ï¼Œé™·å…¥è¶Šæ·±ï¼ŒåŠ›è¶Šå¤§ã€‚   
> &#x2705; ç¬¬äºŒé¡¹ï¼šä¸ºäº†é˜²æ­¢è½åœ°å¼¹é£ï¼Œå¢åŠ é˜»å°¼é¡¹ã€‚



P115  
## Frictional Contact  

![](./assets/08-15.png)



> &#x2705; åŠ¨æ‘©æ“¦åŠ›å¤§å°ï¼æ”¯æŒåŠ› x æ‘©æ“¦ç³»æ•°    
> &#x2705; æ–¹å‘ä¸è¿åŠ¨æ–¹å‘ç›¸å   
> &#x2705; ä¸€èˆ¬ä¸æ¨¡æ‹Ÿé™æ‘©æ“¦åŠ›   
> &#x2705; å—åŠ›åˆ†æï¼šæ”¯æŒåŠ›ï¼ŒåŠ¨æ‘©æ“¦åŠ›ã€‚   



P116  


## Frictional Contact   

$$
\begin{align*}
 f_n&=-k_pd-k_dv_{c,\perp }\\\\
f_t&=-\mu f_n\frac{v_{c,\parallel }}{||v_{c,\parallel }||} 
\end{align*}
$$


> &#x2705; å­˜åœ¨çš„é—®é¢˜ï¼š\\(K_p\\)å¿…é¡»å¾ˆå¤§ï¼Œå¦åˆ™è„šé™·åœ°æ˜æ˜¾ï¼Œæ­¥é•¿å¿…é¡»éå¸¸å°ï¼Œå¦åˆ™ä¸ç¨³å®šã€‚   


  
P118  
## Contact as a Constraint

![](./assets/08-17.png)

$$
x_c  =x+r_c \quad\quad\quad\quad\quad\quad
$$

$$
v_c  =v+\omega \times r_c=J_c \begin{bmatrix}
 v\\\\
w
\end{bmatrix}
$$

$$
v_{c,\perp } =v+\omega \times r_c=J_{c,\perp  }\begin{bmatrix}
v \\\\
\omega 
\end{bmatrix}
$$


> &#x2705; å¦ä¸€ç§æ–¹æ³•ï¼ŒæŠŠæ¥è§¦å»ºæ¨¡ä¸ºçº¦æŸã€‚  



P119  

> &#x2705; çº¦æŸ1ï¼šç‚¹åœ¨ç«–ç›´æ–¹å‘çš„é€Ÿåº¦å¿…é¡»å¤§äº0ï¼Œå³åªèƒ½å‘ä¸Šç§»åŠ¨ã€‚      
> &#x2705; çº¦æŸ2ï¼šåŠ›çš„å¤§å°ä¹Ÿå¤§äº0ï¼   


P120   
## Contact as a Constraint

![](./assets/08-19.png)


> &#x2705; åŠ›å’Œé€Ÿåº¦åªèƒ½æœ‰ä¸€ä¸ªä¸ä¸ºé›¶ï¼Œå¦åˆ™ä¼šåšåŠŸã€‚  
> &#x2705; åˆåœ¨ä¸€èµ·ç§°ä¸ºçº¿æ€§äº’è¡¥æ–¹ç¨‹ï¼Œæ˜¯é€šå¸¸ç¢°æ’å»ºæ¨¡æ–¹å¼ã€‚   
> &#x2705; è¿™ä¸ªæ–¹ç¨‹æ¯”è¾ƒéš¾è§£ï¼Œä¾‹å¦‚ODE    


P121   

## Contact as a Linear Complementary Problem

$$
v_c\perp \lambda =0
$$

(Mixed) Linear Complementary Problem (LCP)   



To solve an LCP:   
e.g. Lemke's algorithm â€“ a simplex algorithm   


P122   
## Contact as a Linear Complementary Problem

How to deal the friction?   

David Baraff. SIGGRAPH â€™94    
Fast contact force computation for nonpenetrating rigid bodies.    

> &#x2705; å¿«é€Ÿå®ç°é™æ‘©æ“¦çº¦æŸçš„å»ºæ¨¡ã€‚   


P123  
## Simulation of a Rigid Body System


![](./assets/08-18.png)   


> &#x2705; æŠŠäººç®€åŒ–ä¸ºåˆ†æ®µåˆšä½“ã€‚æ•´ä½“è¿‡ç¨‹ä¸ºï¼š  
> &#x2705; (1) é»„ï¼šè®¡ç®—å½“å‰çŠ¶æ€ã€‚  
> &#x2705; (2) ç»¿ï¼šè®¡ç®—çº¦æŸï¼Œæ±‚è§£ï¼Œè§£å‡ºä¸‹ä¸€æ—¶åˆ»çš„é€Ÿåº¦ã€‚   
> &#x2705; (3) è“ï¼šæ›´æ–°ä¸‹ä¸€æ—¶åˆ»çš„é‡ï¼ˆç§¯åˆ†ï¼‰ã€‚   
> &#x2705; ç¼ºå°‘éƒ¨åˆ†ï¼šä¸»åŠ¨åŠ› \\(f\\) æ¨åŠ¨è§’è‰²äº§ç”Ÿè¿åŠ¨ã€‚

P124ï¼»ï¼ ï¼½åŠ ä¸€é¡µï¼   



---------------------------------------
> æœ¬æ–‡å‡ºè‡ªCaterpillarStudyGroupï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
>
> https://caterpillarstudygroup.github.io/GAMES105_mdbook/